"use strict";var e=require("atom"),t=require("event-kit"),o=require("svelte/store"),s=require("svelte/internal"),n=require("svelte");class l{constructor(e){this.view=e,this.emitter=new t.Emitter}destroy(){this.emitter.dispose()}hide(){this.view.hide()}show(){this.view.show()}toggle(){this.view.toggle()}stickBottom(){this.view.stickTop=!1}stickTop(){this.view.stickTop=!0}log(e,t="log"){this.view.log(e,t)}error(e){this.log(e,"error")}warn(e){this.log(e,"warning")}info(e){this.log(e,"info")}debug(e){this.log(e,"debug")}raw(e,t="info",o="\n"){e.split(o).map((e=>{this.log(e,t)}))}clear(){this.view.clear()}}var i=o.writable({lines:[],showTimestamp:!0,clear:!1,filters:[]});function a(e=""){const t="console";return e?atom.config.get(`console.${e}`):atom.config.get(t)}function r(){const e=new Date;return{visible:`${`0${e.getHours()}`.slice(-2)}:${`0${e.getMinutes()}`.slice(-2)}:${`0${e.getSeconds()}`.slice(-2)}.${`${e.getMilliseconds()}0`.slice(0,3)}`,tooltip:e.toString()}}function c(e){switch(console.log("mapLevel",e),e){case"debug":return{text:"debug",icon:"icon-bug"};case"error":return{text:"error",icon:"icon-flame"};case"info":return{text:"info",icon:"icon-info"};case"warn":case"warning":return{text:"warning",icon:"icon-issue-opened"};case"raw":return{text:"info",icon:"icon-code"};default:return{text:"highlight",icon:"icon-quote"}}}function d(){return a("wordWrap")?"\n    overflow: hidden;\n    white-space: pre-wrap;\n  ":""}function g(e,t,o){const s=e.slice();return s[10]=t[o].level,s[11]=t[o].message,s[12]=t[o].timestamp,s}function p(e){let t,o=e[11]+"";return{c(){t=s.text(o)},m(e,o){s.insert(e,t,o)},p(e,n){1&n&&o!==(o=e[11]+"")&&s.set_data(t,o)},d(e){e&&s.detach(t)}}}function h(e){let t,o,n,l,i=e[11]+"",a=e[3]&&u(e);return{c(){a&&a.c(),t=s.space(),o=s.element("pre"),n=s.text(i),s.attr(o,"class","message svelte-n6w8gh"),s.attr(o,"style",l=e[2]&&d())},m(e,l){a&&a.m(e,l),s.insert(e,t,l),s.insert(e,o,l),s.append(o,n)},p(e,r){e[3]?a?a.p(e,r):(a=u(e),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),1&r&&i!==(i=e[11]+"")&&s.set_data(n,i),4&r&&l!==(l=e[2]&&d())&&s.attr(o,"style",l)},d(e){a&&a.d(e),e&&s.detach(t),e&&s.detach(o)}}}function u(e){let t,o,n,l,i,a,r,d,g=e[12].visible+"";return{c(){t=s.element("div"),o=s.element("pre"),n=s.element("span"),l=s.text(g),s.attr(n,"class","text-highlight"),s.attr(n,"title",i=e[12].tooltip),s.attr(o,"class",a="badge "+e[4]+"-"+c(e[10]).text+" icon "+c(e[10]).icon+" svelte-n6w8gh"),s.attr(t,"class","timestamp svelte-n6w8gh")},m(i,a){s.insert(i,t,a),s.append(t,o),s.append(o,n),s.append(n,l),r||(d=s.listen(o,"click",e[6]),r=!0)},p(e,t){1&t&&g!==(g=e[12].visible+"")&&s.set_data(l,g),1&t&&i!==(i=e[12].tooltip)&&s.attr(n,"title",i),17&t&&a!==(a="badge "+e[4]+"-"+c(e[10]).text+" icon "+c(e[10]).icon+" svelte-n6w8gh")&&s.attr(o,"class",a)},d(e){e&&s.detach(t),r=!1,d()}}}function m(e){let t,o,n;function l(e,t){return"string"==typeof e[11]?h:p}let i=l(e),a=i(e);return{c(){t=s.element("p"),a.c(),o=s.space(),t.hidden=n=e[5].length&&!e[5].includes(e[10]),s.attr(t,"class","svelte-n6w8gh")},m(e,n){s.insert(e,t,n),a.m(t,null),s.append(t,o)},p(e,s){i===(i=l(e))&&a?a.p(e,s):(a.d(1),a=i(e),a&&(a.c(),a.m(t,o))),33&s&&n!==(n=e[5].length&&!e[5].includes(e[10]))&&(t.hidden=n)},d(e){e&&s.detach(t),a.d()}}}function w(e){let t,o,n,l,i,a,r,c,d,p,h,u,w,f,v=e[0],b=[];for(let t=0;t<v.length;t+=1)b[t]=m(g(e,v,t));return{c(){t=s.element("div"),o=s.element("div"),n=s.element("button"),n.textContent="Log",l=s.space(),i=s.element("button"),i.textContent="Info",a=s.space(),r=s.element("button"),r.textContent="Warning",c=s.space(),d=s.element("button"),d.textContent="Error",p=s.space(),h=s.element("div"),u=s.element("div");for(let e=0;e<b.length;e+=1)b[e].c();s.attr(n,"class","btn"),s.attr(i,"class","btn"),s.attr(r,"class","btn"),s.attr(d,"class","btn"),s.attr(o,"class","btn-group"),s.attr(t,"class","block"),s.attr(u,"class","console-lines svelte-n6w8gh"),s.attr(u,"tabindex","-1"),s.attr(h,"class","panel-body scrollable svelte-n6w8gh")},m(g,m){s.insert(g,t,m),s.append(t,o),s.append(o,n),s.append(o,l),s.append(o,i),s.append(o,a),s.append(o,r),s.append(o,c),s.append(o,d),s.insert(g,p,m),s.insert(g,h,m),s.append(h,u);for(let e=0;e<b.length;e+=1)b[e].m(u,null);e[8](h),w||(f=[s.listen(n,"click",e[7]),s.listen(i,"click",e[7]),s.listen(r,"click",e[7]),s.listen(d,"click",e[7])],w=!0)},p(e,[t]){if(125&t){let o;for(v=e[0],o=0;o<v.length;o+=1){const s=g(e,v,o);b[o]?b[o].p(s,t):(b[o]=m(s),b[o].c(),b[o].m(u,null))}for(;o<b.length;o+=1)b[o].d(1);b.length=v.length}},i:s.noop,o:s.noop,d(o){o&&s.detach(t),o&&s.detach(p),o&&s.detach(h),s.destroy_each(b,o),e[8](null),w=!1,s.run_all(f)}}}function f(e,t,o){let l;const a=i.subscribe((e=>{switch(e.action){case"log":o(0,l=[...e.lines]);break;case"clear":o(0,l=[])}return l}));let r;n.afterUpdate((()=>{r.scrollTo({left:0,top:r.scrollHeight,behaviour:"smooth"})}));let c,d,g;atom.config.observe("console.wordWrap",(e=>{o(2,c=e)})),atom.config.observe("console.showTimestamp",(e=>{o(3,d=e)})),atom.config.observe("console.coloredBadges",(e=>{o(4,g=e?"badge":"text")}));let p=[];return n.onMount((()=>function(){const e=document.querySelector("status-bar");null!=e&&e.offsetHeight&&document.documentElement.style.setProperty("--status-bar-height",`${e.offsetHeight}px`)}())),n.onDestroy(a),[l,r,c,d,g,p,()=>{r.scrollTo({top:0,left:0,behaviour:"smooth"})},e=>{e.target.classList.toggle("selected");const t=e.target.innerText.toLowerCase();i.update((e=>{if(console.log("filters before",e.filters),e.filters.includes(t)){const o=e.filters.indexOf(t);e.filters.splice(o,1)}else e.filters.push(t);return o(5,p=e.filters),console.log("filters after",e.filters),e}))},function(e){s.binding_callbacks[e?"unshift":"push"]((()=>{r=e,o(1,r)}))}]}class v extends s.SvelteComponent{constructor(e){var t;super(),document.getElementById("svelte-n6w8gh-style")||((t=s.element("style")).id="svelte-n6w8gh-style",t.textContent=".scrollable.svelte-n6w8gh.svelte-n6w8gh{height:100%;overflow:auto;width:100%}.panel-body.svelte-n6w8gh.svelte-n6w8gh{background-color:var(--inset-panel-background-color);cursor:text;height:100%}.console-lines.svelte-n6w8gh.svelte-n6w8gh{overflow:visible}.console-lines.svelte-n6w8gh.svelte-n6w8gh:empty{padding:0}p.svelte-n6w8gh.svelte-n6w8gh{display:flex;margin:0}p[hidden].svelte-n6w8gh.svelte-n6w8gh{display:none}p.svelte-n6w8gh .timestamp.svelte-n6w8gh{padding:5px 10px;user-select:none}p.svelte-n6w8gh .badge.svelte-n6w8gh{cursor:pointer;font-size:11px;position:sticky;top:5px}p.svelte-n6w8gh .message.svelte-n6w8gh{font-size:unset;flex-grow:1;margin-bottom:var(--status-bar-height)}p.svelte-n6w8gh .message.svelte-n6w8gh::selection{background-color:var(--background-color-selected);color:var(--text-color-selected)}",s.append(document.head,t)),s.init(this,e,f,w,s.safe_not_equal,{})}}class b{destroy(){null!==this.disposables&&this.disposables.dispose()}getElement(){const e=document.createElement("console");return new v({target:e}),e}getTitle(){return"Console"}getPath(){return"panel"}getURI(){return`atom://console/${this.getPath()}`}getDefaultLocation(){return a("panelLocation")}show(){atom.workspace.open(this,{activatePane:!1}),function(){switch(a("panelLocation").toLowerCase()){case"left":atom.workspace.getLeftDock().show();break;case"right":atom.workspace.getRightDock().show();break;default:atom.workspace.getBottomDock().show()}}()}hide(){!function(){switch(a("panelLocation").toLowerCase()){case"left":atom.workspace.getLeftDock().hide();break;case"right":atom.workspace.getRightDock().hide();break;default:atom.workspace.getBottomDock().hide()}}()}toggle(){atom.workspace.toggle(this)}log(e,t){console.log({level:t,message:e}),i.update((o=>(o.lines=[...o.lines||[],{level:t,message:e,timestamp:r()}],o.action="log",o)))}clear(){console.log("Clearing console"),i.update((e=>(e.action="clear",e.lines=[],e)))}}var k={config:{showTimestamp:{description:"Displays a timestamp next to the output",type:"boolean",default:!0,order:1},coloredBadges:{description:"Colors background of the timestamp badge",type:"boolean",default:!1,order:2},wordWrap:{description:"Wrap words if the line length exceeds the panel width",type:"boolean",default:!0,order:3},panelLocation:{title:"Panel Location",description:"Specifies the panel location. The change will only take effect on the next launch.",type:"string",order:4,enum:[{value:"bottom",description:"bottom"},{value:"left",description:"left"},{value:"right",description:"right"}],default:"bottom"}},consoleView:null,subscriptions:null,activate(){this.consoleView=new b,this.consoleManager=new l(this.consoleView),this.subscriptions=new e.CompositeDisposable,this.subscriptions.add(atom.commands.add("atom-workspace",{"console:show":()=>this.consoleManager.show()})),this.subscriptions.add(atom.commands.add("atom-workspace",{"console:hide":()=>this.consoleManager.hide()})),this.subscriptions.add(atom.commands.add("atom-workspace",{"console:toggle":()=>this.consoleManager.toggle()})),this.subscriptions.add(atom.commands.add("atom-workspace",{"console:clear":()=>this.consoleManager.clear()})),atom.inDevMode()&&(window.cp=this.consoleManager,atom.commands.add("atom-workspace",{"console:log":()=>this.consoleManager.raw({msg:"Hello World"})}))},deactivate(){console.log("Deactivating"),this.subscriptions.dispose(),this.consoleView.destroy()},provideConsole(){return this.consoleManager}};module.exports=k;
//# sourceMappingURL=console.js.map
