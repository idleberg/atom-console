"use strict";var e=require("atom"),t=require("event-kit"),o=require("svelte/store"),s=require("svelte/internal"),n=require("svelte");class a{constructor(e){this.view=e,this.emitter=new t.Emitter}destroy(){var e;null===(e=this.emitter)||void 0===e||e.dispose()}hide(){this.view.hide()}show(){this.view.show()}toggle(){this.view.toggle()}stickBottom(){this.view.stickTop=!1}stickTop(){this.view.stickTop=!0}log(e,t="log"){this.view.log(e,t)}error(e){this.log(e,"error")}warn(e){this.log(e,"warning")}info(e){this.log(e,"info")}debug(e){this.log(e,"debug")}raw(e,t="info",o="\n"){e.split(o).map((e=>{this.log(e,t)}))}clear(){this.view.clear()}}var i=o.writable({lines:[],showTimestamp:!0,clear:!1,filters:[]});function l(e=""){const t="console";return e?atom.config.get(`console.${e}`):atom.config.get(t)}function r(){const e=new Date;return{visible:`${`0${e.getHours()}`.slice(-2)}:${`0${e.getMinutes()}`.slice(-2)}:${`0${e.getSeconds()}`.slice(-2)}.${`${e.getMilliseconds()}0`.slice(0,3)}`,tooltip:e.toString()}}function c(e){switch(e){case"debug":return{text:"debug",icon:"icon-bug"};case"error":return{text:"error",icon:"icon-flame"};case"info":return{text:"info",icon:"icon-info"};case"warn":case"warning":return{text:"warning",icon:"icon-issue-opened"};case"raw":return{text:"info",icon:"icon-code"};default:return{text:"highlight",icon:"icon-quote"}}}function d(){return l("wordWrap")?"\n    overflow: hidden;\n    white-space: pre-wrap;\n  ":""}function p(e,t,o){const s=e.slice();return s[10]=t[o].level,s[11]=t[o].message,s[12]=t[o].timestamp,s}function g(e){let t,o=e[0],n=[];for(let t=0;t<o.length;t+=1)n[t]=v(p(e,o,t));return{c(){for(let e=0;e<n.length;e+=1)n[e].c();t=s.empty()},m(e,o){for(let t=0;t<n.length;t+=1)n[t].m(e,o);s.insert(e,t,o)},p(e,s){if(125&s){let a;for(o=e[0],a=0;a<o.length;a+=1){const i=p(e,o,a);n[a]?n[a].p(i,s):(n[a]=v(i),n[a].c(),n[a].m(t.parentNode,t))}for(;a<n.length;a+=1)n[a].d(1);n.length=o.length}},d(e){s.destroy_each(n,e),e&&s.detach(t)}}}function h(e){let t,o=e[11]+"";return{c(){t=s.text(o)},m(e,o){s.insert(e,t,o)},p(e,n){1&n&&o!==(o=e[11]+"")&&s.set_data(t,o)},d(e){e&&s.detach(t)}}}function u(e){let t,o,n,a,i=e[11]+"",l=e[3]&&m(e);return{c(){l&&l.c(),t=s.space(),o=s.element("pre"),n=s.text(i),s.attr(o,"class","message svelte-9ah1eg"),s.attr(o,"style",a=e[2]&&d())},m(e,a){l&&l.m(e,a),s.insert(e,t,a),s.insert(e,o,a),s.append(o,n)},p(e,r){e[3]?l?l.p(e,r):(l=m(e),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null),1&r&&i!==(i=e[11]+"")&&s.set_data(n,i),4&r&&a!==(a=e[2]&&d())&&s.attr(o,"style",a)},d(e){l&&l.d(e),e&&s.detach(t),e&&s.detach(o)}}}function m(e){let t,o,n,a,i,l,r,d,p,g=e[12].visible+"";return{c(){t=s.element("div"),o=s.element("pre"),n=s.element("span"),a=s.text(g),s.attr(n,"title",i=e[12].tooltip),s.attr(o,"class",l="badge "+e[4]+"-"+c(e[10]).text+" icon "+c(e[10]).icon+" svelte-9ah1eg"),s.attr(t,"class",r="timestamp "+c(e[10]).text+" svelte-9ah1eg")},m(i,l){s.insert(i,t,l),s.append(t,o),s.append(o,n),s.append(n,a),d||(p=s.listen(o,"click",e[6]),d=!0)},p(e,d){1&d&&g!==(g=e[12].visible+"")&&s.set_data(a,g),1&d&&i!==(i=e[12].tooltip)&&s.attr(n,"title",i),17&d&&l!==(l="badge "+e[4]+"-"+c(e[10]).text+" icon "+c(e[10]).icon+" svelte-9ah1eg")&&s.attr(o,"class",l),1&d&&r!==(r="timestamp "+c(e[10]).text+" svelte-9ah1eg")&&s.attr(t,"class",r)},d(e){e&&s.detach(t),d=!1,p()}}}function v(e){let t,o,n;function a(e,t){return"string"==typeof e[11]?u:h}let i=a(e),l=i(e);return{c(){t=s.element("p"),l.c(),o=s.space(),t.hidden=n=e[5].length&&!e[5].includes(e[10]),s.attr(t,"class","svelte-9ah1eg")},m(e,n){s.insert(e,t,n),l.m(t,null),s.append(t,o)},p(e,s){i===(i=a(e))&&l?l.p(e,s):(l.d(1),l=i(e),l&&(l.c(),l.m(t,o))),33&s&&n!==(n=e[5].length&&!e[5].includes(e[10]))&&(t.hidden=n)},d(e){e&&s.detach(t),l.d()}}}function f(e){let t,o,n,a,i,l,r,c,d,p,h,u,m,v,f=e[0]?.length&&g(e);return{c(){t=s.element("div"),o=s.element("div"),n=s.element("button"),n.textContent="Log",a=s.space(),i=s.element("button"),i.textContent="Info",l=s.space(),r=s.element("button"),r.textContent="Warning",c=s.space(),d=s.element("button"),d.textContent="Error",p=s.space(),h=s.element("div"),u=s.element("div"),f&&f.c(),s.attr(n,"class","btn icon icon-quote"),s.attr(i,"class","btn icon icon-info"),s.attr(r,"class","btn icon icon-issue-opened"),s.attr(d,"class","btn icon icon-flame"),s.attr(o,"class","btn-group"),s.attr(t,"class","block"),s.attr(u,"class","console-lines svelte-9ah1eg"),s.attr(u,"tabindex","-1"),s.attr(h,"class","panel-body scrollable svelte-9ah1eg")},m(g,w){s.insert(g,t,w),s.append(t,o),s.append(o,n),s.append(o,a),s.append(o,i),s.append(o,l),s.append(o,r),s.append(o,c),s.append(o,d),s.insert(g,p,w),s.insert(g,h,w),s.append(h,u),f&&f.m(u,null),e[8](h),m||(v=[s.listen(n,"click",e[7]),s.listen(i,"click",e[7]),s.listen(r,"click",e[7]),s.listen(d,"click",e[7])],m=!0)},p(e,[t]){e[0]?.length?f?f.p(e,t):(f=g(e),f.c(),f.m(u,null)):f&&(f.d(1),f=null)},i:s.noop,o:s.noop,d(o){o&&s.detach(t),o&&s.detach(p),o&&s.detach(h),f&&f.d(),e[8](null),m=!1,s.run_all(v)}}}function w(e,t,o){let a;const l=i.subscribe((e=>{switch(e.action){case"log":o(0,a=[...e.lines]);break;case"clear":o(0,a=[])}return a}));let r;n.afterUpdate((()=>{r.scrollTo({left:0,top:r.scrollHeight,behaviour:"smooth"})}));let c,d,p;atom.config.observe("console.wordWrap",(e=>{o(2,c=e)})),atom.config.observe("console.showTimestamp",(e=>{o(3,d=e)})),atom.config.observe("console.coloredBadges",(e=>{o(4,p=e?"badge":"text")}));let g=[];return n.onMount((()=>function(){const e=document.querySelector("status-bar");null!=e&&e.offsetHeight&&document.documentElement.style.setProperty("--status-bar-height",`${e.offsetHeight}px`)}())),n.onDestroy(l),[a,r,c,d,p,g,()=>{r.scrollTo({top:0,left:0,behaviour:"smooth"})},e=>{e.target.classList.toggle("selected");const t=e.target.innerText.toLowerCase();i.update((e=>{if(e.filters.includes(t)){const o=e.filters.indexOf(t);e.filters.splice(o,1)}else e.filters.push(t);return o(5,g=e.filters),e}))},function(e){s.binding_callbacks[e?"unshift":"push"]((()=>{r=e,o(1,r)}))}]}class b extends s.SvelteComponent{constructor(e){var t;super(),document.getElementById("svelte-9ah1eg-style")||((t=s.element("style")).id="svelte-9ah1eg-style",t.textContent=".scrollable.svelte-9ah1eg.svelte-9ah1eg{height:100%;overflow:auto;width:100%}.panel-body.svelte-9ah1eg.svelte-9ah1eg{background-color:var(--inset-panel-background-color);cursor:text;height:100%}.console-lines.svelte-9ah1eg.svelte-9ah1eg{overflow:visible}.console-lines.svelte-9ah1eg.svelte-9ah1eg:empty{padding:0}p.svelte-9ah1eg.svelte-9ah1eg{display:flex;margin:0}p[hidden].svelte-9ah1eg.svelte-9ah1eg{display:none}p.svelte-9ah1eg .timestamp.svelte-9ah1eg{border-left:5px solid;padding:5px;margin-bottom:5px;user-select:none}p.svelte-9ah1eg .timestamp.error.svelte-9ah1eg{border-color:var(--text-color-error)}p.svelte-9ah1eg .timestamp.info.svelte-9ah1eg{border-color:var(--text-color-info)}p.svelte-9ah1eg .timestamp.warning.svelte-9ah1eg{border-color:var(--text-color-warning)}p.svelte-9ah1eg .badge.svelte-9ah1eg{cursor:pointer;font-size:11px;position:sticky;top:5px}p.svelte-9ah1eg .message.svelte-9ah1eg{font-size:unset;flex-grow:1;margin-bottom:var(--status-bar-height)}p.svelte-9ah1eg .message.svelte-9ah1eg::selection{background-color:var(--background-color-selected);color:var(--text-color-selected)}",s.append(document.head,t)),s.init(this,e,w,f,s.safe_not_equal,{})}}class k{destroy(){var e;null===(e=this.disposables)||void 0===e||e.dispose()}getElement(){const e=document.createElement("console");return new b({target:e}),e}getTitle(){return"Console"}getPath(){return"panel"}getURI(){return`atom://console/${this.getPath()}`}getDefaultLocation(){return l("panelLocation")}show(){atom.workspace.open(this,{activatePane:!1}),function(){switch(l("panelLocation").toLowerCase()){case"left":atom.workspace.getLeftDock().show();break;case"right":atom.workspace.getRightDock().show();break;default:atom.workspace.getBottomDock().show()}}()}hide(){!function(){switch(l("panelLocation").toLowerCase()){case"left":atom.workspace.getLeftDock().hide();break;case"right":atom.workspace.getRightDock().hide();break;default:atom.workspace.getBottomDock().hide()}}()}toggle(){atom.workspace.toggle(this)}log(e,t){i.update((o=>(o.lines=[...o.lines||[],{level:t,message:e,timestamp:r()}],o.action="log",o)))}clear(){atom.inDevMode()&&console.log("Clearing console"),i.update((e=>(e.action="clear",e.lines=[],e)))}}var x={config:{showTimestamp:{description:"Displays a timestamp next to the output",type:"boolean",default:!0,order:1},coloredBadges:{description:"Colors background of the timestamp badge",type:"boolean",default:!1,order:2},wordWrap:{description:"Wrap words if the line length exceeds the panel width",type:"boolean",default:!0,order:3},panelLocation:{title:"Panel Location",description:"Specifies the panel location. The change will only take effect on the next launch.",type:"string",order:4,enum:[{value:"bottom",description:"bottom"},{value:"left",description:"left"},{value:"right",description:"right"}],default:"bottom"}},consoleView:null,subscriptions:null,activate(){atom.inDevMode()&&console.log("Activating package"),this.consoleView=new k,this.consoleManager=new a(this.consoleView),this.subscriptions=new e.CompositeDisposable,this.subscriptions.add(atom.commands.add("atom-workspace",{"console:show":()=>this.consoleManager.show()})),this.subscriptions.add(atom.commands.add("atom-workspace",{"console:hide":()=>this.consoleManager.hide()})),this.subscriptions.add(atom.commands.add("atom-workspace",{"console:toggle":()=>this.consoleManager.toggle()})),this.subscriptions.add(atom.commands.add("atom-workspace",{"console:clear":()=>this.consoleManager.clear()})),atom.inDevMode()&&(window.cp=this.consoleManager,atom.commands.add("atom-workspace",{"console:log":()=>this.consoleManager.raw({msg:"Hello World"})}))},deactivate(){var e,t;atom.inDevMode()&&console.log("Deactivating package"),null===(e=this.subscriptions)||void 0===e||e.dispose(),null===(t=this.consoleView)||void 0===t||t.destroy()},provideConsole(){return atom.inDevMode()&&console.log("Providing service"),this.consoleManager}};module.exports=x;
//# sourceMappingURL=console.js.map
